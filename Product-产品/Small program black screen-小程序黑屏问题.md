## 小程序黑屏问题

### 背景：

迷衣小程序刚上线的一段时间，不停的有用户和我们反馈iOS上会有白屏问题，在反馈之后也很难复现，后来后端做了一个接口访问日志打在后台(后端埋点)，我就看到那些白屏的用户在产品列表(productList)访问了七八十页，就白屏，对应安卓用户就是黑屏。然后我们就参考京东每20页（400件商品，后来改为10页，200件商品），做一个大翻页，降低内存损耗，保障用户浏览。

然后，过了很长一段时间，偶尔有一两个用户和我反馈说黑屏(只在安卓有，iOS没反馈)，甚至有一次有一位用户买了一台P20，刚逛几分钟就黑屏，我们也买了台P20，结果死活没黑屏。。。然后前端工程师和我说可能是微信自己的问题，所以就一直搁置没太大在意(因为大部分用户都是用iOS的)。直到有一天。。。我们最大消费最强的用户(一年买了几百万)，和老板说，我刚换的三星S10+，刚用迷衣小程序几分钟就黑屏了，以前用S8的时候还能坚持半小时的。这个时候我们就真正重视起来了。

### 排查情况：

小程序自身也有10层的层级限制，我们为了让用户浏览得更深，是在第10层做了一个出入栈的替换方案，保证用户最大限度下有路可退。但这也会带来一个后果，如果浏览得过深，就容易使用内存超过1G，然后黑屏，或者干脆小程序闪退(直接退回微信)。

本质原因就是内存使用太多了，目前正在优化三个最主要的页面中。

### 10层才做无限层的出入栈真的好吗？

不好，京东限制在第8层，LOOK限制在第6和第7层，如下图所示：

https://tokyo.cdn.xiyanghui.com/0001c306ac4f8645bd407fda90408812-222.JPG

### 别人家解决了吗？

并没有，不论是京东还是其他电商小程序，只要页面层级访问一多，大约也就在第7、8、9层的时候，很大概率会出现黑屏或白屏（Android）。

